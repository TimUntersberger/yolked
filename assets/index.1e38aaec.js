var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,o=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&i(e,n,t[n]);if(a)for(var n of a(t))r.call(t,n)&&i(e,n,t[n]);return e},c=(e,a)=>t(e,n(a));import{R as l,r as p,a as d,b as u,H as m,P as g,c as h}from"./vendor.e63d21ec.js";function y(e){let t={display:"flex"};return e.inline&&(t.display="inline-flex"),e.column&&(t.flexDirection="column"),e.centerVertical&&(e.column?t.justifyContent="center":t.alignItems="center"),e.centerHorizontal&&(e.column?t.alignItems="center":t.justifyContent="center"),l.createElement("div",{className:e.className,style:t},e.children)}class _{async create_file(e){const t=await gapi.client.request({path:"drive/v3/files",method:"POST",body:e});return JSON.parse(t.body)}async get_all_by_query(e){const t=await gapi.client.request({path:"drive/v3/files",method:"GET",params:{q:e}});return JSON.parse(t.body).files}async get_one_by_query(e){const t=await gapi.client.request({path:"drive/v3/files",method:"GET",params:{q:e,pageSize:1}});return JSON.parse(t.body).files[0]}async get_all(){const e=await gapi.client.request({path:"drive/v3/files",method:"GET"});return JSON.parse(e.body).files}async create_folder(e){return this.create_file(c(o({},e),{mimeType:"application/vnd.google-apps.folder"}))}async delete_item(e){await gapi.client.request({path:"drive/v3/files/"+e,method:"DELETE"})}}const f="https://sheets.googleapis.com/v4/spreadsheets/";class b{constructor(e,t){this.id=e,this.title=t}static from_json(e){return new b(e.spreadsheetId,e.properties.title)}async append(e){await gapi.client.request({path:f+this.id+"/values/A1:append",method:"POST",body:{range:"A1",majorDimension:"ROWS",values:e},params:{valueInputOption:"RAW"}})}async get_all(){return this.get_range("Sheet1")}async get_range(e){const t=await gapi.client.request({path:f+this.id+"/values/"+e,method:"GET"});return JSON.parse(t.body).values}}class w{async create(e){const t=await gapi.client.request({path:f,method:"POST",body:{properties:{title:e}}});return b.from_json(JSON.parse(t.body))}async get_by_id(e){try{const t=await gapi.client.request({path:f+e,method:"GET"});return b.from_json(JSON.parse(t.body))}catch{return null}}async get_all(){return await E.drive.get_all_by_query("mimeType = 'application/vnd.google-apps.spreadsheet'").then((e=>e.map((e=>new b(e.id,e.name)))))}async get_all_by_query(e){return await E.drive.get_all_by_query(`mimeType = 'application/vnd.google-apps.spreadsheet' and ${e}`).then((e=>e.map((e=>new b(e.id,e.name)))))}async get_one_by_query(e){return await E.drive.get_one_by_query(`mimeType = 'application/vnd.google-apps.spreadsheet' and ${e}`).then((e=>e&&new b(e.id,e.name)))}async get_by_name(e){return await this.get_one_by_query(`name = '${e}'`)}}const v=["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.appdata"].join(" ");var E=new class{constructor(){this.initialized=!1,this.signed_in=!1,this.drive=new _,this.sheets=new w,this.event_handler=()=>{}}load(){return new Promise((e=>{gapi.load("client:auth2",(()=>{e()}))}))}init(){return new Promise((e=>{gapi.auth2.init({client_id:"783083744421-e7sv195ihcgmq1bvpqdpevneu7otam00.apps.googleusercontent.com",scope:v,ux_mode:"popup"}).then((t=>{this.initialized=!0,this.signed_in=t.isSignedIn.get(),t.isSignedIn.listen((e=>{this.signed_in=e,this.event_handler(e?"signIn":"signOut")})),this.event_handler("initialized"),e()}))}))}get_user(){return gapi.auth2.getAuthInstance().currentUser.get()}set_event_handler(e){this.event_handler=e}sign_in(){if(!this.signed_in)return gapi.auth2.getAuthInstance().signIn()}sign_out(){this.signed_in&&gapi.auth2.getAuthInstance().signOut()}};class x{constructor(e){this.schema=e}open(){return new Promise(((e,t)=>{const n=indexedDB.open(this.schema.name,this.schema.version);n.onerror=e=>{t(e)},n.onsuccess=t=>{this.idb=t.target.result,e()},n.onupgradeneeded=e=>{this.idb=e.target.result,this.create_schema()}}))}transaction(e,t){return new Promise(((n,a)=>{const s=this.idb.transaction(e,"readwrite");s.onerror=a,s.oncomplete=n;const r=s.objectStore(e);t(r)}))}to_array(e){return new Promise(((t,n)=>{const a=[];this.transaction(e,(e=>{const s=e.openCursor();s.onerror=n,s.onsuccess=e=>{const n=e.target.result;n?(a.push([n.key,n.value]),n.continue()):t(a)}}))}))}for_each(e,t){this.transaction(e,(e=>{e.openCursor().onsuccess=e=>{const n=e.target.result;n&&(t(n.key,n.value),n.continue())}}))}async insert(e,t,n){return new Promise((async(a,s)=>{await this.transaction(e,(e=>{const r=e.add(n,t);r.onerror=s,r.onsuccess=e=>a(e.target.result)}))}))}async delete(e,t){return new Promise((async(n,a)=>{await this.transaction(e,(e=>{const s=e.delete(t);s.onerror=a,s.onsuccess=e=>n(e.target.result)}))}))}async select(e,t,n){return new Promise((async(a,s)=>{await this.transaction(e,(e=>{const r=e.add(n,t);r.onerror=s,r.onsuccess=a}))}))}create_schema(){for(const t of this.schema.tables)try{this.idb.objectStoreNames.contains(t.name)&&(console.info("Deleting "+t.name),this.idb.deleteObjectStore(t.name)),console.info("Creating "+t.name),this.idb.createObjectStore(t.name,t)}catch(e){console.error(e)}}}const S=window;S.TEST=async function(){const e=await S.DB.idb.insert("exercises",null,"test");S.DB.idb.for_each("exercises",console.log),await S.DB.idb.delete("exercises",e),S.DB.idb.for_each("exercises",console.log)};class O{constructor(e,t){this.name=e,this.sheet=t}async add(...e){return this.sheet.append([e])}async get_all(){return this.sheet.get_all()}}const I="__yolked_index";var q=new class{constructor(e){this.table_names=e,this.idb=new x({name:"YolkedDb",version:8,tables:[{name:"exercises",autoIncrement:!0},{name:"workouts",autoIncrement:!0},{name:"programs",autoIncrement:!0}]}),this.prefixed_table_names=e.map((e=>"__yolked_"+e))}async create_tables(){const e=[I].concat(this.prefixed_table_names),[t,...n]=await Promise.all(e.map((async e=>new O(e,await E.sheets.create(e)))));await t.sheet.append([n.map((e=>e.sheet.id))])}async cleanup(){const e=await E.sheets.get_all_by_query([I,...this.prefixed_table_names].map((e=>`name = '${e}'`)).join(" or "));await Promise.all(e.map((e=>E.drive.delete_item(e.id))))}async init(){await this.idb.open()}}(["exercises","workouts","programs"]);function P(e,t,n){return c(o({},e),{data:c(o({},e.data),{[t]:n})})}const N={Input:e=>{const[t,n]=p.exports.useState(e.data.defaultValue||""),a=e.data.convert||(e=>e);return p.exports.useEffect((()=>{const n=a(t);e.data.setElements((t=>{const a=t.filter((t=>t.source==e.id));return t.map((e=>{for(const t of a)if(t.target==e.id)return P(e,t.targetHandle,n);return e}))}))}),[t]),l.createElement("div",{className:"p-2 border flex flex-col bg-white"},l.createElement("span",{className:"self-center"},e.data.title),l.createElement("input",{className:"bg-gray-100 px-2",onChange:e=>n(e.target.value),value:t}),l.createElement(m,{type:"source",onConnect:n=>{e.data.setElements((e=>e.map((e=>e.id==n.target?P(e,n.targetHandle,a(t)):e))))},position:g.Right}))},Effect:e=>{const t=e.data.inputs.map((t=>e.data[t.id])),n=e.data.inputs||[];return p.exports.useEffect((()=>{e.data.callback(t)}),t),l.createElement("div",{className:"p-2 bg-blue-100"},n.map(((e,t)=>l.createElement(m,{key:t,type:"target",id:e.id,style:1==n.length?{}:{top:10+20*t},position:e.position||g.Left}))),l.createElement("span",null,e.data.title))},Add:e=>l.createElement("div",{className:"p-2 bg-blue-100"},l.createElement(m,{type:"target",id:"x",style:{top:10},position:g.Left}),l.createElement(m,{type:"target",id:"y",style:{top:30},position:g.Left}),l.createElement("div",null,"Add"),l.createElement("span",null,e.data.x+e.data.y))};function j(){const[e,t]=p.exports.useState([]);return l.createElement(y,{column:!0,className:"h-full w-full"},l.createElement(y,{className:"px-2 py-1"},l.createElement("div",{className:"px-2 py-1 bg-gray-100 cursor-pointer",onClick:()=>{t([...e,{id:e.length.toString(),type:"Input",data:{title:"Input",setElements:t},position:{x:200,y:200}}])}},"Input"),l.createElement("div",{className:"ml-2 px-2 py-1 bg-gray-100 cursor-pointer",onClick:()=>{t([...e,{id:e.length.toString(),type:"Effect",data:{title:"console.log",inputs:[{id:"value"}],callback:e=>{console.log(e[0])}},position:{x:200,y:200}}])}},"console.log")),l.createElement(d,{paneMoveable:!0,elements:e,onConnect:e=>{t((t=>u(e,t)))},nodeTypes:N}))}function T(e){if(e){const t=e.getBasicProfile();if(t)return{name:t.getName(),image:t.getImageUrl()}}return null}function k(){const[e,t]=p.exports.useState(E.signed_in),[n,a]=p.exports.useState(null),[s,r]=p.exports.useState(!1);return p.exports.useState(!1),p.exports.useEffect((()=>{q.init(),E.load().then((async()=>{await E.init();const e=gapi.auth2.getAuthInstance();a(T(e.currentUser.get())),e.currentUser.listen((e=>{console.log(e),a(T(e))})),r(!0)})),E.set_event_handler((e=>{console.log("new event: "+e),t(E.signed_in)}))}),[]),l.createElement(j,null)}window.GAPI=E,window.DB=q,h.render(l.createElement(l.StrictMode,null,l.createElement(k,null)),document.getElementById("root"));
